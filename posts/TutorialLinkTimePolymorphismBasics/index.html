<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Tutorial: Link-time polymorphism basics" /><meta property="og:locale" content="en" /><meta name="description" content="Everyone knows what runtime and compile time polymorphisms are, but what about link-time polymorphism? There is much less materials about this type of polymorphism and it seems almost forgotten. So I’ve decided to write tutorial about its basics." /><meta property="og:description" content="Everyone knows what runtime and compile time polymorphisms are, but what about link-time polymorphism? There is much less materials about this type of polymorphism and it seems almost forgotten. So I’ve decided to write tutorial about its basics." /><link rel="canonical" href="/posts/TutorialLinkTimePolymorphismBasics/" /><meta property="og:url" content="/posts/TutorialLinkTimePolymorphismBasics/" /><meta property="og:site_name" content="WHAT KIND OF DEV ARE YOU" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-07-01T15:15:00+03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Tutorial: Link-time polymorphism basics" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-07-01T15:15:00+03:00","datePublished":"2022-07-01T15:15:00+03:00","description":"Everyone knows what runtime and compile time polymorphisms are, but what about link-time polymorphism? There is much less materials about this type of polymorphism and it seems almost forgotten. So I’ve decided to write tutorial about its basics.","headline":"Tutorial: Link-time polymorphism basics","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/TutorialLinkTimePolymorphismBasics/"},"url":"/posts/TutorialLinkTimePolymorphismBasics/"}</script><title>Tutorial: Link-time polymorphism basics | WHAT KIND OF DEV ARE YOU</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="WHAT KIND OF DEV ARE YOU"><meta name="application-name" content="WHAT KIND OF DEV ARE YOU"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">WHAT KIND OF DEV ARE YOU</a></div><div class="site-subtitle font-italic">Personal blog above Game Development and related things</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/KonstantinTomashevich" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://t.me/WhatKindOfDevAreYou" aria-label="telegram" target="_blank" rel="noopener"> <i class="fab fa-telegram"></i> </a> <a href="https://t.me/KonstantinTomashevich" aria-label="telegram" target="_blank" rel="noopener"> <i class="fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/in/konstantin-tomashevich-1881aa152/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Tutorial: Link-time polymorphism basics</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Tutorial: Link-time polymorphism basics</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1656677700" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 1, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/KonstantinTomashevich">Konstantin Tomashevich</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2074 words"> <em>11 min</em> read</span></div></div></div><div class="post-content"><p>Everyone knows what runtime and compile time polymorphisms are, but what about link-time polymorphism? There is much less materials about this type of polymorphism and it seems almost forgotten. So I’ve decided to write tutorial about its basics.</p><h3 id="what-link-time-polimorphism-is"><span class="mr-2">What link-time polimorphism is?</span><a href="#what-link-time-polimorphism-is" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Runtime polymorphism operates on top of virtual methods, lambdas and function pointers. Compile time polymorphism utilizes special template-based techniques like SFINAE and CRTP to get things done. But what could we do during link time? While assembling compiled object files into monolithic libraries and executables linker also resolves so-called external references: declarations that are visible to compiled object but are defined outside of its scope. And that’s exactly where the secret of link-time polymorphism is hidden: we’re selecting where linker searches for these definitions and by switching definitions we could achieve polymorphism. The most classic example is C standard library: if you’re using only standard functions, your program could be compiled on any system that supports C, but each time different implementation library would be linked to your program. Let’s discuss pros and cons of this method.</p><p>Pros:</p><ul><li>There is no runtime cost of link-time polymorphism: call cost is equal to regular function call and even inlining is possible through link-time optimizations.<li>There is no additional compile time cost: we’re not creating hordes of templates like in compile time polymorphism, therefore compilation time is not higher that for regular code without polymorphism.<li>It’s the only method that can be used to hide platform-specific code.</ul><p>Cons:</p><ul><li>You cannot change implementation while program is running because linking is already done. However, if dynamic linking is used, it is possible to change implementation between program executions by swapping shared library.<li>You need buildsystem support: decision what libraries to link is done through build system, therefore you need to be ready to modify it.</ul><p>As you can see, link-time polymorphism is not a silver bullet and it has its own restrictions. But, in my opinion, it deserves to be used much more that it is used nowadays: in a lot of cases we don’t really need to change implementation while program is running, but runtime polymorphism is still used and so we’re paying excessive performance price for it.</p><h3 id="example-problem"><span class="mr-2">Example problem</span><a href="#example-problem" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Let’s imagine that our application needs to serialize data in textual format in development mode for easier debugging and in binary format in production mode for smaller file size. The most classic solution for such cases is runtime polymorphism: using pure virtual class with two implementations: for production and for development. It is working solution, but is looks kind of clumpsy for me:</p><ul><li>We don’t ever need to switch implementations during runtime, but we’re paying runtime polymorphism costs.<li>Unneded development logic will be compiled into production executable and vice versa. It’s not critical, of course, but not elegant either.</ul><p>Through runtime polymorphism works well enough here, I’m not satisified with this kind of approach, therefore I’ve decided to write simple step-by-step tutorial how to do that with link-time polymorphism.</p><h3 id="initial-solution"><span class="mr-2">Initial solution</span><a href="#initial-solution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Let’s start from the simplest way of implementing link-time polymorphism: object file selection. It means that we decide on buildsystem level which files belong to the target and by that we are selecting correct implementation for our target.</p><h4 id="interface"><span class="mr-2">Interface</span><a href="#interface" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>The best way to start is to draft our serialization interface. For the purpose of simplicity we will just serialize strings and ints and append comments to development mode files. Of course, it is not even near the real serializers, but it’s better to have simple unrealistic example than difficult to understand but real one.</p><div file="Library/Serialization/Serializer.hpp" class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="Library/Serialization/Serializer.hpp"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="cp">#pragma once
</span>
<span class="cp">#include</span> <span class="cpf">&lt;cstdint&gt;</span><span class="cp">
</span>
<span class="c1">// We are using PImpl approach to hide implementation data from user code.</span>
<span class="c1">// https://en.cppreference.com/w/cpp/language/pimpl</span>
<span class="c1">// It also allows to easily switch DLLs.</span>
<span class="c1">//</span>
<span class="c1">// The other approach is to use inplace fixed size array, which is better for</span>
<span class="c1">// this case, but makes  tutorial much less readable. So I've decided to sacrifice</span>
<span class="c1">// performance for readability, because performance means nothing here.</span>
<span class="k">struct</span> <span class="nc">SerializerImplementation</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Serializer</span> <span class="k">final</span>
<span class="p">{</span>
<span class="nl">public:</span>
    <span class="k">explicit</span> <span class="n">Serializer</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_outputFileName</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>

    <span class="n">Serializer</span> <span class="p">(</span><span class="k">const</span> <span class="n">Serializer</span> <span class="o">&amp;</span><span class="n">_other</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>

    <span class="n">Serializer</span> <span class="p">(</span><span class="n">Serializer</span> <span class="o">&amp;&amp;</span><span class="n">_other</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>

    <span class="o">~</span><span class="n">Serializer</span> <span class="p">()</span> <span class="k">noexcept</span><span class="p">;</span>

    <span class="kt">void</span> <span class="n">WriteInt32</span> <span class="p">(</span><span class="kt">int32_t</span> <span class="n">_number</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>

    <span class="kt">void</span> <span class="n">WriteAsciiString</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_string</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>

    <span class="kt">void</span> <span class="n">WriteAsciiComment</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_string</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>

<span class="nl">private:</span>
    <span class="c1">// We cannot use std::unique_ptr here because SerializerImplementation is undefined.</span>
    <span class="n">SerializerImplementation</span> <span class="o">*</span><span class="n">implementation</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>
<span class="p">};</span>

</pre></table></code></div></div><h4 id="implementations"><span class="mr-2">Implementations</span><a href="#implementations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Both our implementations will write data to a file through <code class="language-plaintext highlighter-rouge">std::ofstream</code>. So they will have same <code class="language-plaintext highlighter-rouge">SerializerImplementation</code>, move constructor and destructor. We don’t want to duplicate this code, therefore it makes sense that this code should be common for both implementations.</p><div file="Library/Serialization/Common/SerializerPrivate.hpp" class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="Library/Serialization/Common/SerializerPrivate.hpp"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="cp">#pragma once
</span>
<span class="cp">#include</span> <span class="cpf">&lt;fstream&gt;</span><span class="cp">
</span>
<span class="cp">#include</span> <span class="cpf">&lt;Serialization/Serializer.hpp&gt;</span><span class="cp">
</span>
<span class="k">struct</span> <span class="nc">SerializerImplementation</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">ofstream</span> <span class="n">output</span><span class="p">;</span>
<span class="p">};</span>
</pre></table></code></div></div><div file="Library/Serialization/Common/SerializerPrivate.cpp" class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="Library/Serialization/Common/SerializerPrivate.cpp"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;Serialization/Common/SerializerPrivate.hpp&gt;</span><span class="cp">
</span>
<span class="n">Serializer</span><span class="o">::</span><span class="n">Serializer</span> <span class="p">(</span><span class="n">Serializer</span> <span class="o">&amp;&amp;</span><span class="n">_other</span><span class="p">)</span> <span class="k">noexcept</span> <span class="o">:</span> <span class="n">implementation</span> <span class="p">(</span><span class="n">_other</span><span class="p">.</span><span class="n">implementation</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">_other</span><span class="p">.</span><span class="n">implementation</span> <span class="o">=</span> <span class="nb">nullptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">Serializer</span><span class="o">::~</span><span class="n">Serializer</span> <span class="p">()</span> <span class="k">noexcept</span>
<span class="p">{</span>
    <span class="k">delete</span> <span class="n">implementation</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Now lets focus on our sample implementations. <code class="language-plaintext highlighter-rouge">Development</code> implementation will save each element directly as text, separating them using line ends:</p><div file="Library/Serialization/Development/Serializer.cpp" class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="Library/Serialization/Development/Serializer.cpp"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;Serialization/Common/SerializerPrivate.hpp&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;Serialization/Serializer.hpp&gt;</span><span class="cp">
</span>
<span class="n">Serializer</span><span class="o">::</span><span class="n">Serializer</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_outputFileName</span><span class="p">)</span> <span class="k">noexcept</span>
    <span class="o">:</span> <span class="n">implementation</span> <span class="p">(</span><span class="k">new</span> <span class="n">SerializerImplementation</span> <span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">ofstream</span> <span class="p">{</span><span class="n">_outputFileName</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ofstream</span><span class="o">::</span><span class="n">out</span><span class="p">}})</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Serializer</span><span class="o">::</span><span class="n">WriteInt32</span> <span class="p">(</span><span class="kt">int32_t</span> <span class="n">_number</span><span class="p">)</span> <span class="k">noexcept</span>
<span class="p">{</span>
    <span class="n">implementation</span><span class="o">-&gt;</span><span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="n">_number</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Serializer</span><span class="o">::</span><span class="n">WriteAsciiString</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_string</span><span class="p">)</span> <span class="k">noexcept</span>
<span class="p">{</span>
    <span class="n">implementation</span><span class="o">-&gt;</span><span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="n">_string</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Serializer</span><span class="o">::</span><span class="n">WriteAsciiComment</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_string</span><span class="p">)</span> <span class="k">noexcept</span>
<span class="p">{</span>
    <span class="n">implementation</span><span class="o">-&gt;</span><span class="n">output</span> <span class="o">&lt;&lt;</span> <span class="s">"# "</span> <span class="o">&lt;&lt;</span> <span class="n">_string</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>For <code class="language-plaintext highlighter-rouge">Production</code> implementation we will directly use binary output:</p><div file="Library/Serialization/Production/Serializer.cpp" class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="Library/Serialization/Production/Serializer.cpp"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="cp">#define _CRT_SECURE_NO_WARNINGS
</span>
<span class="cp">#include</span> <span class="cpf">&lt;Serialization/Common/SerializerPrivate.hpp&gt;</span><span class="cp">
#include</span> <span class="cpf">&lt;Serialization/Serializer.hpp&gt;</span><span class="cp">
</span>
<span class="n">Serializer</span><span class="o">::</span><span class="n">Serializer</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_outputFileName</span><span class="p">)</span> <span class="k">noexcept</span>
    <span class="o">:</span> <span class="n">implementation</span> <span class="p">(</span>
          <span class="k">new</span> <span class="n">SerializerImplementation</span> <span class="p">{</span><span class="n">std</span><span class="o">::</span><span class="n">ofstream</span> <span class="p">{</span><span class="n">_outputFileName</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">ofstream</span><span class="o">::</span><span class="n">out</span> <span class="o">|</span> <span class="n">std</span><span class="o">::</span><span class="n">ofstream</span><span class="o">::</span><span class="n">binary</span><span class="p">}})</span>
<span class="p">{</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Serializer</span><span class="o">::</span><span class="n">WriteInt32</span> <span class="p">(</span><span class="kt">int32_t</span> <span class="n">_number</span><span class="p">)</span> <span class="k">noexcept</span>
<span class="p">{</span>
    <span class="c1">// It is incorrect to save ints like this because we ignore endianness. But it is ok enough for our sample.</span>
    <span class="n">implementation</span><span class="o">-&gt;</span><span class="n">output</span><span class="p">.</span><span class="n">write</span> <span class="p">(</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*&gt;</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">_number</span><span class="p">),</span> <span class="k">sizeof</span> <span class="p">(</span><span class="n">_number</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Serializer</span><span class="o">::</span><span class="n">WriteAsciiString</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_string</span><span class="p">)</span> <span class="k">noexcept</span>
<span class="p">{</span>
    <span class="c1">// We are adding 1 to strlen in order to capture zero terminator.</span>
    <span class="n">implementation</span><span class="o">-&gt;</span><span class="n">output</span><span class="p">.</span><span class="n">write</span> <span class="p">(</span><span class="n">_string</span><span class="p">,</span> <span class="n">strlen</span> <span class="p">(</span><span class="n">_string</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1u</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Serializer</span><span class="o">::</span><span class="n">WriteAsciiComment</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">_string</span><span class="p">)</span> <span class="k">noexcept</span>
<span class="p">{</span>
    <span class="c1">// There is no comments in production files.</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="user-application"><span class="mr-2">User application</span><a href="#user-application" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>For this sample we will keep user application as small as possible, because we have no need for complex logic here:</p><div file="App/Main.cpp" class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="App/Main.cpp"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="cp">#include</span> <span class="cpf">&lt;Serialization/Serializer.hpp&gt;</span><span class="cp">
</span>
<span class="kt">int</span> <span class="nf">main</span> <span class="p">()</span>
<span class="p">{</span>
    <span class="n">Serializer</span> <span class="n">serializer</span> <span class="p">{</span><span class="s">"Test.out"</span><span class="p">};</span>
    <span class="n">serializer</span><span class="p">.</span><span class="n">WriteAsciiComment</span> <span class="p">(</span><span class="s">"This is test file comment line."</span><span class="p">);</span>
    <span class="n">serializer</span><span class="p">.</span><span class="n">WriteAsciiString</span> <span class="p">(</span><span class="s">"Hello, world!"</span><span class="p">);</span>
    <span class="n">serializer</span><span class="p">.</span><span class="n">WriteInt32</span> <span class="p">(</span><span class="mi">1024</span><span class="p">);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="cmake-script"><span class="mr-2">CMake script</span><a href="#cmake-script" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><p>Finally, we have arrived at our final and most important logic: CMake build system script. It is fairly simplistic because we’re using the simpliest approach of link-time polymorphism:</p><div file="CMakeLists.txt" class="language-cmake highlighter-rouge"><div class="code-header"> <span data-label-text="CMakeLists.txt"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="nb">cmake_minimum_required</span> <span class="p">(</span>VERSION 3.21<span class="p">)</span>
<span class="nb">project</span> <span class="p">(</span>LinkTimePolymorphismBasicsProject<span class="p">)</span>

<span class="nb">set</span> <span class="p">(</span>CMAKE_CXX_STANDARD 20<span class="p">)</span>

<span class="c1"># Build system option that is used for implementation selection.</span>
<span class="nb">option</span> <span class="p">(</span>DEVELOPMENT <span class="s2">"Whether to use development serialization library."</span> OFF<span class="p">)</span>

<span class="c1"># Declare core set of sources, that are used in any case.</span>
<span class="nb">set</span> <span class="p">(</span>SOURCES
        <span class="s2">"App/Main.cpp"</span>
        <span class="s2">"Library/Serialization/Serializer.hpp"</span>
        <span class="s2">"Library/Serialization/Common/SerializerPrivate.cpp"</span>
        <span class="s2">"Library/Serialization/Common/SerializerPrivate.hpp"</span><span class="p">)</span>

<span class="c1"># Depending on build system option append source file with implementation.</span>
<span class="nb">if</span> <span class="p">(</span>DEVELOPMENT<span class="p">)</span>
    <span class="nb">list</span> <span class="p">(</span>APPEND SOURCES <span class="s2">"Library/Serialization/Development/Serializer.cpp"</span><span class="p">)</span>
<span class="nb">else</span> <span class="p">()</span>
    <span class="nb">list</span> <span class="p">(</span>APPEND SOURCES <span class="s2">"Library/Serialization/Production/Serializer.cpp"</span><span class="p">)</span>
<span class="nb">endif</span> <span class="p">()</span>

<span class="c1"># Finally, create our application target.</span>
<span class="nb">add_executable</span> <span class="p">(</span>App <span class="si">${</span><span class="nv">SOURCES</span><span class="si">}</span><span class="p">)</span>
<span class="nb">target_include_directories</span> <span class="p">(</span>App PRIVATE <span class="s2">"Library/"</span><span class="p">)</span>
</pre></table></code></div></div><p>Despite being the most simple and straighforward way to use link-time polymorphism, direct file selection is the most widely used approach: it is the usual go-to solution for platform-independence layers implementations and other layers, like graphics API independence layer. But it is not “poetic” enough, isn’t it? Below we will discover more scalable and more “poetic” approaches of link-time polymorphism.</p><h3 id="implementations-as-separate-libraries"><span class="mr-2">Implementations as separate libraries</span><a href="#implementations-as-separate-libraries" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>While direct file selection is simple, it is also not really scalable: it would be difficult to manage APIs with lots of files like that. But there is more scalable approach: creating and linking diffirent CMake libraries. Let’s modify our example to use this approach.</p><p>To do this we need to split our CMake script into several ones. Let’s start from CMakeLists.txt for <code class="language-plaintext highlighter-rouge">Serialization</code> library:</p><div file="Library/Serialization/CMakeLists.txt" class="language-cmake highlighter-rouge"><div class="code-header"> <span data-label-text="Library/Serialization/CMakeLists.txt"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1"># Let's start from header-only API target. It only contains include path and our API header.</span>
<span class="nb">add_library</span> <span class="p">(</span>SerializationAPI INTERFACE <span class="s2">"Serializer.hpp"</span><span class="p">)</span>
<span class="nb">target_include_directories</span> <span class="p">(</span>SerializationAPI INTERFACE <span class="s2">".."</span><span class="p">)</span>

<span class="c1"># Declare common library target that will be used by both our implementations.</span>
<span class="nb">add_library</span> <span class="p">(</span>SerializationCommon STATIC <span class="s2">"Common/SerializerPrivate.cpp"</span> <span class="s2">"Common/SerializerPrivate.hpp"</span><span class="p">)</span>
<span class="nb">target_link_libraries</span> <span class="p">(</span>SerializationCommon PUBLIC SerializationAPI<span class="p">)</span>

<span class="c1"># Declare Development implementation library.</span>
<span class="nb">add_library</span> <span class="p">(</span>SerializationDevelopment STATIC <span class="s2">"Development/Serializer.cpp"</span><span class="p">)</span>
<span class="nb">target_link_libraries</span> <span class="p">(</span>SerializationDevelopment PUBLIC SerializationCommon<span class="p">)</span>

<span class="c1"># Declare Production implementation library.</span>
<span class="nb">add_library</span> <span class="p">(</span>SerializationProduction STATIC <span class="s2">"Production/Serializer.cpp"</span><span class="p">)</span>
<span class="nb">target_link_libraries</span> <span class="p">(</span>SerializationProduction PUBLIC SerializationCommon<span class="p">)</span>
</pre></table></code></div></div><p>Let’s also move our test executable setup into separate script:</p><div file="App/CMakeLists.txt" class="language-cmake highlighter-rouge"><div class="code-header"> <span data-label-text="App/CMakeLists.txt"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nb">add_executable</span> <span class="p">(</span>App <span class="s2">"Main.cpp"</span><span class="p">)</span>

<span class="c1"># Link required implementation library depending on build option.</span>
<span class="nb">if</span> <span class="p">(</span>DEVELOPMENT<span class="p">)</span>
    <span class="nb">target_link_libraries</span> <span class="p">(</span>App PRIVATE SerializationDevelopment<span class="p">)</span>
<span class="nb">else</span> <span class="p">()</span>
    <span class="nb">target_link_libraries</span> <span class="p">(</span>App PRIVATE SerializationProduction<span class="p">)</span>
<span class="nb">endif</span> <span class="p">()</span>
</pre></table></code></div></div><p>After that our root script will become quite small:</p><div file="CMakeLists.txt" class="language-cmake highlighter-rouge"><div class="code-header"> <span data-label-text="CMakeLists.txt"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nb">cmake_minimum_required</span> <span class="p">(</span>VERSION 3.21<span class="p">)</span>
<span class="nb">project</span> <span class="p">(</span>LinkTimePolymorphismBasicsProject<span class="p">)</span>

<span class="nb">set</span> <span class="p">(</span>CMAKE_CXX_STANDARD 20<span class="p">)</span>

<span class="c1"># Build system option that is used for implementation selection.</span>
<span class="nb">option</span> <span class="p">(</span>DEVELOPMENT <span class="s2">"Whether to use development serialization library."</span> OFF<span class="p">)</span>

<span class="c1"># Just add our scripts for application and library.</span>
<span class="nb">add_subdirectory</span> <span class="p">(</span>App<span class="p">)</span>
<span class="nb">add_subdirectory</span> <span class="p">(</span>Library/Serialization<span class="p">)</span>
</pre></table></code></div></div><p>This approach is not only more advanced and scalable: it is also much more CMake-friendly, because changing source file list triggers full target recompilation, but changing link dependency only triggers relinking! It means that changing link-time polymorphism implementation will be quite fast, because compiler won’t need to recompile any of the source files.</p><h3 id="switching-implementations-without-rebuilding-the-application"><span class="mr-2">Switching implementations without rebuilding the application</span><a href="#switching-implementations-without-rebuilding-the-application" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>One of the coolest moments about link-time polymorphism is that we can swap implementations between program executions if we’re using dynamic linking. Let’s try it out! To migrate to dynamic linking we firsly need to add export/import information to our API (it is required only on Windows, but nevertheleess it’s better to know how to do it):</p><div file="Library/Serialization/Serializer.hpp" class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="Library/Serialization/Serializer.hpp"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1">// Includes ...</span>

<span class="c1">// Declare whether we're exporting or importing dynamic symbols. Needed only for Windows builds.</span>
<span class="cp">#ifdef SERIALIZATION_IMPLEMENTATION
#    define SERIALIZATION_API __declspec(dllexport)
#else
#    define SERIALIZATION_API __declspec(dllimport)
#endif
</span>
<span class="c1">// ...</span>
<span class="k">class</span> <span class="nc">SERIALIZATION_API</span> <span class="n">Serializer</span> <span class="k">final</span>
<span class="c1">// ...</span>
</pre></table></code></div></div><p>Now we need to update our libraries build script by making several changes:</p><ul><li>Adding <code class="language-plaintext highlighter-rouge">SERIALIZATION_IMPLEMENTATION</code> compile define to targets that implement any methods.<li>Making our libraries <code class="language-plaintext highlighter-rouge">SHARED</code> for dynamic linking.<li>Making sure that both implementation libraries outputs are named <code class="language-plaintext highlighter-rouge">Serialization</code> so we can swap files.</ul><p>After these changes library script will look like this:</p><div file="Library/Serialization/CMakeLists.txt" class="language-cmake highlighter-rouge"><div class="code-header"> <span data-label-text="Library/Serialization/CMakeLists.txt"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c1"># Let's start from header-only API target. It only contains include path and our API header.</span>
<span class="nb">add_library</span> <span class="p">(</span>SerializationAPI INTERFACE <span class="s2">"Serializer.hpp"</span><span class="p">)</span>
<span class="nb">target_include_directories</span> <span class="p">(</span>SerializationAPI INTERFACE <span class="s2">".."</span><span class="p">)</span>

<span class="c1"># Declare common library target that will be used by both our implementations.</span>
<span class="c1"># NOTE: In order for implementation detection to work properly we need to make </span>
<span class="c1">#       this library shared too. Implementation detection will flag `no destructor`</span>
<span class="c1">#       link error if we link it as static library like before.</span>
<span class="nb">add_library</span> <span class="p">(</span>SerializationCommon SHARED <span class="s2">"Common/SerializerPrivate.cpp"</span> <span class="s2">"Common/SerializerPrivate.hpp"</span><span class="p">)</span>
<span class="nb">target_link_libraries</span> <span class="p">(</span>SerializationCommon PUBLIC SerializationAPI<span class="p">)</span>
<span class="nb">target_compile_definitions</span> <span class="p">(</span>SerializationCommon PRIVATE SERIALIZATION_IMPLEMENTATION<span class="p">)</span>

<span class="c1"># Declare Development implementation library.</span>
<span class="nb">add_library</span> <span class="p">(</span>SerializationDevelopment SHARED <span class="s2">"Development/Serializer.cpp"</span><span class="p">)</span>
<span class="nb">target_link_libraries</span> <span class="p">(</span>SerializationDevelopment PUBLIC SerializationCommon<span class="p">)</span>
<span class="nb">target_compile_definitions</span> <span class="p">(</span>SerializationDevelopment PRIVATE SERIALIZATION_IMPLEMENTATION<span class="p">)</span>
<span class="nb">set_target_properties</span> <span class="p">(</span>SerializationDevelopment PROPERTIES OUTPUT_NAME <span class="s2">"Development/Serialization"</span><span class="p">)</span>

<span class="c1"># Declare Production implementation library.</span>
<span class="nb">add_library</span> <span class="p">(</span>SerializationProduction SHARED <span class="s2">"Production/Serializer.cpp"</span><span class="p">)</span>
<span class="nb">target_link_libraries</span> <span class="p">(</span>SerializationProduction PUBLIC SerializationCommon<span class="p">)</span>
<span class="nb">target_compile_definitions</span> <span class="p">(</span>SerializationProduction PRIVATE SERIALIZATION_IMPLEMENTATION<span class="p">)</span>
<span class="nb">set_target_properties</span> <span class="p">(</span>SerializationProduction PROPERTIES OUTPUT_NAME <span class="s2">"Production/Serialization"</span><span class="p">)</span>
</pre></table></code></div></div><p>As the last step we need to teach our example app target to copy libraries to its folder:</p><div file="App/CMakeLists.txt" class="language-cmake highlighter-rouge"><div class="code-header"> <span data-label-text="App/CMakeLists.txt"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c1"># Target definition...</span>

<span class="c1"># We need to copy runtime libraries to our executable folder.</span>
<span class="nb">add_custom_command</span> <span class="p">(</span>
        TARGET App POST_BUILD
        COMMAND <span class="si">${</span><span class="nv">CMAKE_COMMAND</span><span class="si">}</span> -E copy_if_different $&lt;TARGET_RUNTIME_DLLS:App&gt; $&lt;TARGET_FILE_DIR:App&gt;
        COMMAND_EXPAND_LISTS<span class="p">)</span>
</pre></table></code></div></div><p>And that’s all that we need to do in order to make implementations swappable as files! Now you can try to replace DLL (or SO) files and see that it really works! You can download the full source code from <a href="https://github.com/WhatKindOfDevAreYou/LinkTimePolymorphismBasicsProject">GitHub repository</a>.</p><p>Hope you’ve enjoyed reading! :)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/tutorials/'>Tutorials</a>, <a href='/categories/architecture/'>Architecture</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/tutorials/" class="post-tag no-text-decoration" >Tutorials</a> <a href="/tags/c/" class="post-tag no-text-decoration" >C++</a> <a href="/tags/cmake/" class="post-tag no-text-decoration" >CMake</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Tutorial%3A+Link-time+polymorphism+basics+-+WHAT+KIND+OF+DEV+ARE+YOU&url=%2Fposts%2FTutorialLinkTimePolymorphismBasics%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Tutorial%3A+Link-time+polymorphism+basics+-+WHAT+KIND+OF+DEV+ARE+YOU&u=%2Fposts%2FTutorialLinkTimePolymorphismBasics%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2FTutorialLinkTimePolymorphismBasics%2F&text=Tutorial%3A+Link-time+polymorphism+basics+-+WHAT+KIND+OF+DEV+ARE+YOU" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=%2Fposts%2FTutorialLinkTimePolymorphismBasics%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/EmergenceWhyIsThereNoEntitiesInCelerity/">Emergence: Why is there no entities in Celerity?</a><li><a href="/posts/ArrowToTheKneeEditingUnorderedMultisetItems/">Arrow to the Knee: Editing unordered_multiset items</a><li><a href="/posts/EmergenceInterpolatingTransform/">Emergence: Interpolating transform</a><li><a href="/posts/EmergenceWhat&Why/">Emergence: What & Why?</a><li><a href="/posts/HintGlobalInitializationOrder/">Hint: Global Initialization Order</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/emergence/">Emergence</a> <a class="post-tag" href="/tags/gamedev/">GameDev</a> <a class="post-tag" href="/tags/tutorials/">Tutorials</a> <a class="post-tag" href="/tags/ecs/">ECS</a> <a class="post-tag" href="/tags/algorithms/">Algorithms</a> <a class="post-tag" href="/tags/arrow-to-the-knee/">Arrow to the Knee</a> <a class="post-tag" href="/tags/cmake/">CMake</a> <a class="post-tag" href="/tags/containers/">Containers</a> <a class="post-tag" href="/tags/math/">Math</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ProblemSolvingValidatingECSGraph/"><div class="card-body"> <em class="small" data-ts="1657109700" data-df="ll" > Jul 6, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Problem solving: Validating ECS graph</h3><div class="text-muted small"><p> Designing algorithms is quite rare task, so it is always feels great when you can apply this skill to solve some practical problem. In this post I’ll talk about ECS graph validation algorithm that ...</p></div></div></a></div><div class="card"> <a href="/posts/TutorialStringInterning/"><div class="card-body"> <em class="small" data-ts="1657650600" data-df="ll" > Jul 12, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Tutorial: String interning</h3><div class="text-muted small"><p> Is there a lot of instances of the same string in your application that are wasting lots of space? Or are you checking equality or hashing strings quite often and wondering how to do it more effic...</p></div></div></a></div><div class="card"> <a href="/posts/EmergenceWhat&Why/"><div class="card-body"> <em class="small" data-ts="1655560800" data-df="ll" > Jun 18, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Emergence: What & Why?</h3><div class="text-muted small"><p> I’ve been developing Emergence project for more than a year. Or two years, if you count a previous unfortunate attempt! I’ve decided to finally come out of the shadow and start writing about it. To...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/EmergenceInterpolatingTransform/" class="btn btn-outline-primary" prompt="Older"><p>Emergence: Interpolating transform</p></a> <a href="/posts/ProblemSolvingValidatingECSGraph/" class="btn btn-outline-primary" prompt="Newer"><p>Problem solving: Validating ECS graph</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "WhatKindOfDevAreYou/WhatKindOfDevAreYou.github.io", "data-repo-id": "R_kgDOHhaiVA", "data-category": "GitHub Pages Comments", "data-category-id": "DIC_kwDOHhaiVM4CPv5_", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/KonstantinTomashevich">Konstantin Tomashevich</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/emergence/">Emergence</a> <a class="post-tag" href="/tags/gamedev/">GameDev</a> <a class="post-tag" href="/tags/tutorials/">Tutorials</a> <a class="post-tag" href="/tags/ecs/">ECS</a> <a class="post-tag" href="/tags/algorithms/">Algorithms</a> <a class="post-tag" href="/tags/arrow-to-the-knee/">Arrow to the Knee</a> <a class="post-tag" href="/tags/cmake/">CMake</a> <a class="post-tag" href="/tags/containers/">Containers</a> <a class="post-tag" href="/tags/math/">Math</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>

<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Emergence: Why is there no entities in Celerity?" /><meta property="og:locale" content="en" /><meta name="description" content="Entity is the first of the three core principles of ECS design pattern. Nevertheless, I’ve decided that there should be no entities in Emergence ECS-like framework Celerity. I will tell you how I’ve arrived at this decision in this post." /><meta property="og:description" content="Entity is the first of the three core principles of ECS design pattern. Nevertheless, I’ve decided that there should be no entities in Emergence ECS-like framework Celerity. I will tell you how I’ve arrived at this decision in this post." /><link rel="canonical" href="/posts/EmergenceWhyIsThereNoEntitiesInCelerity/" /><meta property="og:url" content="/posts/EmergenceWhyIsThereNoEntitiesInCelerity/" /><meta property="og:site_name" content="WHAT KIND OF DEV ARE YOU" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-06-23T12:40:00+03:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Emergence: Why is there no entities in Celerity?" /><meta name="twitter:site" content="@twitter_username" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-07-25T23:36:53+03:00","datePublished":"2022-06-23T12:40:00+03:00","description":"Entity is the first of the three core principles of ECS design pattern. Nevertheless, I’ve decided that there should be no entities in Emergence ECS-like framework Celerity. I will tell you how I’ve arrived at this decision in this post.","headline":"Emergence: Why is there no entities in Celerity?","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/EmergenceWhyIsThereNoEntitiesInCelerity/"},"url":"/posts/EmergenceWhyIsThereNoEntitiesInCelerity/"}</script><title>Emergence: Why is there no entities in Celerity? | WHAT KIND OF DEV ARE YOU</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="WHAT KIND OF DEV ARE YOU"><meta name="application-name" content="WHAT KIND OF DEV ARE YOU"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">WHAT KIND OF DEV ARE YOU</a></div><div class="site-subtitle font-italic">Personal blog above Game Development and related things</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/KonstantinTomashevich" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://t.me/WhatKindOfDevAreYou" aria-label="telegram" target="_blank" rel="noopener"> <i class="fab fa-telegram"></i> </a> <a href="https://t.me/KonstantinTomashevich" aria-label="telegram" target="_blank" rel="noopener"> <i class="fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/in/konstantin-tomashevich-1881aa152/" aria-label="linkedin" target="_blank" rel="noopener"> <i class="fab fa-linkedin"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Emergence: Why is there no entities in Celerity?</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Emergence: Why is there no entities in Celerity?</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1655977200" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jun 23, 2022 </em> </span> <span> Updated <em class="" data-ts="1658781413" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 25, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/KonstantinTomashevich">Konstantin Tomashevich</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1536 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><p>Entity is the first of the three core principles of ECS design pattern. Nevertheless, I’ve decided that there should be no entities in <a href="https://github.com/KonstantinTomashevich/Emergence">Emergence</a> ECS-like framework Celerity. I will tell you how I’ve arrived at this decision in this post.</p><h3 id="ecs-pattern"><span class="mr-2">ECS pattern</span><a href="#ecs-pattern" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>For those who are not familiar with the Entity-Component-System pattern I have decided to write a quick recap.</p><p>Historically, ECS is the evolution of the <a href="https://gameprogrammingpatterns.com/component.html">Components</a> pattern, in which the parts of the game world, usually called game objects or actors, can receive additional features through the addition of components with custom logic. This pattern has saved quite a few projects from the drawbacks of the malicious “just write the game logic and use inheritance” pattern, used extensively in the old days. That’s the reason why <a href="https://gameprogrammingpatterns.com/component.html">Components</a> is a core feature of both well-known engines, like Unity and Unreal Engine, and less known ones, like Urho3D.</p><p>But <a href="https://gameprogrammingpatterns.com/component.html">Components</a> pattern didn’t solve all the pitfalls of its predecessor, and one of the most malicious problems was the update order. When every object and every component chaotically subscribes to update the routine, it is not only difficult to know whether it uses the current frame or the previous frame state of the other objects, but also nearly impossible to track what happens during the game loop. This kind of chaos is a problem by itself, but it leads to another problem too: how to make the gameplay logic parallel when everything is so chaotic and uncontrollable?</p><p>That’s where Entity-Component-System comes to the rescue by removing all the logic from the components and returning to the times of procedural programming. Sounds too dramatic and old-fashioned? Maybe, but it has really helped to sort things out, so let’s describe what it is by first describing 3 core pillars of ECS:</p><ul><li><p><strong>Entity</strong>: it is something that exists inside the game world. It might be a tree, a player, an invisible controller. But the entity by itself has no logic at all, it is just a collection of components! Nothing more, nothing less.</p><li><p><strong>Component</strong>: it is just a collection of data, possibly even a plain-old-data structure. Ideally, components have no logic at all, just a data layout. But sometimes there are utility functions that help access data or modify it without breaking the coherency.</p><li><p><strong>System</strong>: it is a place to put the game logic into. It might be a function or something more sophisticated. The core rule is that all meaningful logic should be placed inside systems, and the systems themselves depend on each other to make the update order predictable.</p></ul><p>So, what problems does this pattern solve?</p><ul><li>Update order is always predictable due to the dependencies between the systems that contain all the logic.<li>It is much easier to make the logic parallel, because systems access well-known sets of components, so we can just execute them simultaneously if they do not both modify the same component type.<li>It is much easier to serialize data and send it over the network, because the logic is separated from the data.</ul><p>Now you know what ECS theoretically is, so we can discuss the topic of entities deeper.</p><h3 id="what-is-an-entity"><span class="mr-2">What is an Entity?</span><a href="#what-is-an-entity" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Many old-school developers still think of entities as game objects without logic: just the game objects that store multiple components. It is not incorrect to think like that, but in my opinion it hides the storage-management aspect of ECS by simply treating entities as vectors.</p><p>Modern approaches usually treat entities as just numbers. Yes, simple numbers that are used to query components from their component storages. For example, we can have a separate memory pool for each component type, so that the access to several components of the same type will be much more cache coherent. Of course, it is not the only “correct” way to treat the entity concept: there are things like entity family locality optimizations, but I won’t dig further into that topic in this post as I’m not an expert in that.</p><p>But let’s dig deeper into the “entity as number” idea. Doesn’t it remind you of some other topics from computer science? Like foreign indices from relational databases? The thing is that we can view component types as tables and entities as foreign keys that create relations between components. I like to draw parallels between different computer science topics, and therefore I really like this connection: it looks like a powerful path to improve ECS pattern even further by adding an ability to create other indices instead of only querying by the entity id. It is not a fresh idea, but I’ve never seen any successful implementations of that principle, therefore I have decided that I must try to implement it myself.</p><h3 id="how-the-additional-indexing-helps"><span class="mr-2">How the additional indexing helps?</span><a href="#how-the-additional-indexing-helps" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>At first glance additional indices might sound excessive. Why do we need them after all if everything worked fine without them? But I’m convinced that there are enough cases to justify that we need them:</p><ul><li><p>In some projects there are a lot of so-called flag components, like <code class="language-plaintext highlighter-rouge">AliveComponent</code>, <code class="language-plaintext highlighter-rouge">ReadyToSpawnComponent</code>, etc. These components have no data and are only used to filter entities. But if we were able to create additional indices, we wouldn’t need these components anymore: we could just store this data as fields, like <code class="language-plaintext highlighter-rouge">bool alive</code>, and create indices for these fields. Feel the need to iterate over all the alive units? Just use a query on this index.</p><li><p>I’ve seen a lot of expressions like <code class="language-plaintext highlighter-rouge">if (timeNow &lt; component-&gt;coolingDownUntil) continue;</code>. It’s not only bad for the performance, but also decreases readability by adding checks like this everywhere. But why not create a sorted index on <code class="language-plaintext highlighter-rouge">coolingDownUntil</code>? It would allow us to get the cooled down entities fast and without the iterate-over-everything overhead. And because the cool down is not really applied every frame, the index usage overhead will be really tiny.</p><li><p>Almost always there are some so-called managers that accompany the game world. For example, <code class="language-plaintext highlighter-rouge">ConfigManager</code> or <code class="language-plaintext highlighter-rouge">WeaponStatsManager</code>. Usually, these managers work as glorified hash maps, which made me think: why not put their data as additional tables inside the game world? We can use the same API to create indices over configs and stats ids and to get rid of excessive managers.</p></ul><h3 id="game-world-as-a-universal-storage"><span class="mr-2">Game world as a universal storage</span><a href="#game-world-as-a-universal-storage" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>By allowing users to create additional tables and indices for whatever they need, we convert the game world into some kind of universal storage. We can store a lot of things there:</p><ul><li>Components, first and foremost.<li>Records with a short lifetime, like events. Just don’t index them. :)<li>Singletons.<li>Configs.<li>Stats.<li>Maybe even assets!</ul><p>It might sound messy, but it also sounds really powerful, isn’t it? At least it is for me, therefore I decided to make it the core idea for my ECS implementation. Sticking to this idea makes the principle of entities obsolete: we just have tables with records and systems (personally, I prefer to call them tasks) that operate on these records.</p><p>Of course, this approach has its pros and cons. Let’s start from pros:</p><ul><li>User can store everything in the game world and treat all the data in the same way.<li>Indices can be created for whatever user needs without restrictions.</ul><p>And there are cons:</p><ul><li>Entity family optimizations can not be applied here, because there are no entities.<li>It might be difficult to navigate in storage, because it will store almost everything.</ul><p>For me, pros outweigh the cons, but you’re free to argue about it.</p><p>In the end, I’d like to share some examples from my unfinished demo to show how this works.</p><h4 id="inserting-physical-material-into-the-world"><span class="mr-2">Inserting physical material into the world</span><a href="#inserting-physical-material-into-the-world" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="c1">// Tasks (systems) store prepared queries as fields. This query allows user to insert records.</span>
<span class="n">Emergence</span><span class="o">::</span><span class="n">Celerity</span><span class="o">::</span><span class="n">InsertLongTermQuery</span> <span class="n">insertDynamicsMaterial</span><span class="p">;</span>
<span class="c1">// ...</span>

<span class="c1">/// Task initialize queries in constructors.</span>
<span class="o">:</span> <span class="n">insertDynamicsMaterial</span> <span class="p">(</span><span class="n">INSERT_LONG_TERM</span> <span class="p">(</span><span class="n">Emergence</span><span class="o">::</span><span class="n">Physics</span><span class="o">::</span><span class="n">DynamicsMaterial</span><span class="p">)),</span>
<span class="c1">// ...</span>

<span class="c1">// Then we can insert materials using this query during task execution.</span>
<span class="k">auto</span> <span class="n">materialCursor</span> <span class="o">=</span> <span class="n">insertDynamicsMaterial</span><span class="p">.</span><span class="n">Execute</span> <span class="p">();</span>
<span class="k">auto</span> <span class="o">*</span><span class="n">material</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">Emergence</span><span class="o">::</span><span class="n">Physics</span><span class="o">::</span><span class="n">DynamicsMaterial</span> <span class="o">*&gt;</span> <span class="p">(</span><span class="o">++</span><span class="n">materialCursor</span><span class="p">);</span>

<span class="n">material</span><span class="o">-&gt;</span><span class="n">id</span> <span class="o">=</span> <span class="n">PhysicsConstant</span><span class="o">::</span><span class="n">DEFAULT_MATERIAL_ID</span><span class="p">;</span>
<span class="n">material</span><span class="o">-&gt;</span><span class="n">staticFriction</span> <span class="o">=</span> <span class="mf">0.4</span><span class="n">f</span><span class="p">;</span>
<span class="n">material</span><span class="o">-&gt;</span><span class="n">dynamicFriction</span> <span class="o">=</span> <span class="mf">0.4</span><span class="n">f</span><span class="p">;</span>
<span class="n">material</span><span class="o">-&gt;</span><span class="n">enableFriction</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="n">material</span><span class="o">-&gt;</span><span class="n">restitution</span> <span class="o">=</span> <span class="mf">0.3</span><span class="n">f</span><span class="p">;</span>
<span class="n">material</span><span class="o">-&gt;</span><span class="n">density</span> <span class="o">=</span> <span class="mf">400.0</span><span class="n">f</span><span class="p">;</span>
</pre></table></code></div></div><h4 id="querying-by-an-entity-object-id"><span class="mr-2">Querying by an entity (object) id</span><a href="#querying-by-an-entity-object-id" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="c1">// This query allows user to gain read-only access to all records with</span>
<span class="c1">// requested value in given field.</span>
<span class="n">Emergence</span><span class="o">::</span><span class="n">Celerity</span><span class="o">::</span><span class="n">FetchValueQuery</span> <span class="n">fetchShapeByObjectId</span><span class="p">;</span>
<span class="c1">// ...</span>

<span class="o">:</span> <span class="n">fetchShapeByObjectId</span> <span class="p">(</span><span class="n">FETCH_VALUE_1F</span> <span class="p">(</span><span class="n">CollisionShapeComponent</span><span class="p">,</span> <span class="n">objectId</span><span class="p">)),</span>
<span class="c1">// ...</span>

<span class="c1">// Process all shapes on object using prepared query and cycle.</span>
<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">shapeCursor</span> <span class="o">=</span> <span class="n">fetchShapeByObjectId</span><span class="p">.</span><span class="n">Execute</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">objectId</span><span class="p">);</span>
     <span class="k">const</span> <span class="k">auto</span> <span class="o">*</span><span class="n">shape</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">CollisionShapeComponent</span> <span class="o">*&gt;</span> <span class="p">(</span><span class="o">*</span><span class="n">shapeCursor</span><span class="p">);</span> <span class="o">++</span><span class="n">shapeCursor</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></table></code></div></div><h4 id="querying-cooled-down-components"><span class="mr-2">Querying cooled down components</span><a href="#querying-cooled-down-components" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h4><div class="language-c++ highlighter-rouge"><div class="code-header"> <span data-label-text="C++"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="c1">// This query allows user to gain full write access to all records</span>
<span class="c1">// where field value is inside given interval.</span>
<span class="n">Emergence</span><span class="o">::</span><span class="n">Celerity</span><span class="o">::</span><span class="n">ModifyAscendingRangeQuery</span> <span class="n">modifyShootersByCoolingDownUntil</span><span class="p">;</span>
<span class="c1">// ...</span>

<span class="o">:</span> <span class="n">modifyShootersByCoolingDownUntil</span> <span class="p">(</span><span class="n">MODIFY_ASCENDING_RANGE</span> <span class="p">(</span><span class="n">ShooterComponent</span><span class="p">,</span> <span class="n">coolingDownUntilNs</span><span class="p">)),</span>
<span class="c1">/// ...</span>

<span class="c1">// Process all the shooters where the cool down ended before this moment.</span>
<span class="c1">// `nullptr` as query argument represents negative (if first) or positive (if second) infinity.</span>
<span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">shooterCursor</span> <span class="o">=</span> <span class="n">modifyShootersByCoolingDownUntil</span><span class="p">.</span><span class="n">Execute</span> <span class="p">(</span><span class="nb">nullptr</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">time</span><span class="o">-&gt;</span><span class="n">fixedTimeNs</span><span class="p">);</span>
     <span class="k">auto</span> <span class="o">*</span><span class="n">shooter</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">ShooterComponent</span> <span class="o">*&gt;</span> <span class="p">(</span><span class="o">*</span><span class="n">shooterCursor</span><span class="p">);)</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</pre></table></code></div></div><p>That’s all for now. Hope you’ve enjoyed reading! :)</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/emergence/'>Emergence</a>, <a href='/categories/development-log/'>Development Log</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/emergence/" class="post-tag no-text-decoration" >Emergence</a> <a href="/tags/ecs/" class="post-tag no-text-decoration" >ECS</a> <a href="/tags/gamedev/" class="post-tag no-text-decoration" >GameDev</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Emergence%3A+Why+is+there+no+entities+in+Celerity%3F+-+WHAT+KIND+OF+DEV+ARE+YOU&url=%2Fposts%2FEmergenceWhyIsThereNoEntitiesInCelerity%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Emergence%3A+Why+is+there+no+entities+in+Celerity%3F+-+WHAT+KIND+OF+DEV+ARE+YOU&u=%2Fposts%2FEmergenceWhyIsThereNoEntitiesInCelerity%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2FEmergenceWhyIsThereNoEntitiesInCelerity%2F&text=Emergence%3A+Why+is+there+no+entities+in+Celerity%3F+-+WHAT+KIND+OF+DEV+ARE+YOU" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=%2Fposts%2FEmergenceWhyIsThereNoEntitiesInCelerity%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/EmergenceWhyIsThereNoEntitiesInCelerity/">Emergence: Why is there no entities in Celerity?</a><li><a href="/posts/ArrowToTheKneeEditingUnorderedMultisetItems/">Arrow to the Knee: Editing unordered_multiset items</a><li><a href="/posts/EmergenceInterpolatingTransform/">Emergence: Interpolating transform</a><li><a href="/posts/EmergenceWhat&Why/">Emergence: What & Why?</a><li><a href="/posts/HintGlobalInitializationOrder/">Hint: Global Initialization Order</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/emergence/">Emergence</a> <a class="post-tag" href="/tags/gamedev/">GameDev</a> <a class="post-tag" href="/tags/tutorials/">Tutorials</a> <a class="post-tag" href="/tags/ecs/">ECS</a> <a class="post-tag" href="/tags/algorithms/">Algorithms</a> <a class="post-tag" href="/tags/arrow-to-the-knee/">Arrow to the Knee</a> <a class="post-tag" href="/tags/cmake/">CMake</a> <a class="post-tag" href="/tags/containers/">Containers</a> <a class="post-tag" href="/tags/math/">Math</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/EmergenceWhat&Why/"><div class="card-body"> <em class="small" data-ts="1655560800" data-df="ll" > Jun 18, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Emergence: What & Why?</h3><div class="text-muted small"><p> I’ve been developing Emergence project for more than a year. Or two years, if you count a previous unfortunate attempt! I’ve decided to finally come out of the shadow and start writing about it. To...</p></div></div></a></div><div class="card"> <a href="/posts/EmergenceInterpolatingTransform/"><div class="card-body"> <em class="small" data-ts="1656351000" data-df="ll" > Jun 27, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Emergence: Interpolating transform</h3><div class="text-muted small"><p> What if I say that every game object in Emergence has two transforms? What for? For the sake of making everything look cool, of course! In this post I will describe transform interpolation, which i...</p></div></div></a></div><div class="card"> <a href="/posts/EmergenceReflection/"><div class="card-body"> <em class="small" data-ts="1658573400" data-df="ll" > Jul 23, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Emergence: Reflection</h3><div class="text-muted small"><p> Reflection system is an important part of every engine, but there is no standard solution for that in C++: there are lots of libraries with their pros and cons. I’ve decided to write my own reflec...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/ArrowToTheKneeEditingUnorderedMultisetItems/" class="btn btn-outline-primary" prompt="Older"><p>Arrow to the Knee: Editing unordered_multiset items</p></a> <a href="/posts/EmergenceInterpolatingTransform/" class="btn btn-outline-primary" prompt="Newer"><p>Emergence: Interpolating transform</p></a></div><script type="text/javascript"> $(function () { const origin = "https://giscus.app"; const iframe = "iframe.giscus-frame"; const lightTheme = "light"; const darkTheme = "dark_dimmed"; let initTheme = lightTheme; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = darkTheme; } let giscusAttributes = { "src": "https://giscus.app/client.js", "data-repo": "WhatKindOfDevAreYou/WhatKindOfDevAreYou.github.io", "data-repo-id": "R_kgDOHhaiVA", "data-category": "GitHub Pages Comments", "data-category-id": "DIC_kwDOHhaiVM4CPv5_", "data-mapping": "pathname", "data-reactions-enabled": "1", "data-emit-metadata": "0", "data-theme": initTheme, "data-input-position": "bottom", "data-lang": "en", "crossorigin": "anonymous", "async": "" }; let giscusScript = document.createElement("script"); Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value)); document.getElementById("tail-wrapper").appendChild(giscusScript); addEventListener("message", (event) => { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { /* global theme mode changed */ const mode = event.data.message; const theme = (mode === ModeToggle.DARK_MODE ? darkTheme : lightTheme); const message = { setConfig: { theme: theme } }; const giscus = document.querySelector(iframe).contentWindow; giscus.postMessage({ giscus: message }, origin); } }); }); </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/KonstantinTomashevich">Konstantin Tomashevich</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/emergence/">Emergence</a> <a class="post-tag" href="/tags/gamedev/">GameDev</a> <a class="post-tag" href="/tags/tutorials/">Tutorials</a> <a class="post-tag" href="/tags/ecs/">ECS</a> <a class="post-tag" href="/tags/algorithms/">Algorithms</a> <a class="post-tag" href="/tags/arrow-to-the-knee/">Arrow to the Knee</a> <a class="post-tag" href="/tags/cmake/">CMake</a> <a class="post-tag" href="/tags/containers/">Containers</a> <a class="post-tag" href="/tags/math/">Math</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
